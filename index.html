<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Anti-cache –º–µ—Ç–∞-—Ç–µ–≥–∏ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>UserManager - –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π CRM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω —Å –∫–æ—Å–º–æ—Å–æ–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg,
                    #0a192f 0%,
                    #112240 25%,
                    #1a365d 50%,
                    #2d3748 75%,
                    #0a192f 100%);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: #e2e8f0;
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            transition: background 0.5s ease, color 0.5s ease;
        }

        /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
        body.light-theme {
            background: linear-gradient(135deg,
                    #f8fafc 0%,
                    #f1f5f9 25%,
                    #e2e8f0 50%,
                    #cbd5e1 75%,
                    #f8fafc 100%);
            color: #334155;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        /* –ó–≤–µ–∑–¥–Ω–æ–µ –Ω–µ–±–æ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã) */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        body.light-theme .stars {
            opacity: 0;
            display: none;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle var(--duration) infinite var(--delay);
        }

        @keyframes twinkle {
            0%, 100% {
                opacity: 0.2;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.1);
            }
        }

        /* –ü–ª–∞–Ω–µ—Ç–∞ */
        .planet {
            position: fixed;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%,
                    #3b82f6 0%,
                    #1d4ed8 30%,
                    #0c4a6e 70%);
            box-shadow:
                inset -20px -20px 40px rgba(0, 0, 0, 0.5),
                inset 10px 10px 40px rgba(255, 255, 255, 0.1),
                0 0 80px rgba(59, 130, 246, 0.3);
            top: 10%;
            right: 5%;
            z-index: 0;
            opacity: 0.7;
            animation: float 20s infinite ease-in-out;
            transition: opacity 0.5s ease;
        }

        body.light-theme .planet {
            opacity: 0.3;
            background: radial-gradient(circle at 30% 30%,
                    #3b82f6 0%,
                    #1d4ed8 20%,
                    #93c5fd 70%);
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            33% {
                transform: translateY(-20px) rotate(120deg);
            }
            66% {
                transform: translateY(20px) rotate(240deg);
            }
        }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ–≤–µ—Ä—Ö —Ñ–æ–Ω–∞ */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ */
        .centered-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
        }

        /* –ì–ª–∞–≤–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
        .main-title-container {
            margin: 3rem 0;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 900px;
            width: 90%;
            transition: all 0.5s ease;
        }

        body.light-theme .main-title-container {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .main-title {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #60a5fa, #3b82f6, #1d4ed8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        body.light-theme .main-title {
            background: linear-gradient(45deg, #1d4ed8, #3b82f6, #60a5fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .main-subtitle {
            font-size: 1.2rem;
            color: #bbdefb;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        body.light-theme .main-subtitle {
            color: #64748b;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-menu {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
            align-items: center;
        }

        .nav-item {
            color: #bbdefb;
            text-decoration: none;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            transition: all 0.3s;
            font-weight: 500;
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        body.light-theme .nav-item {
            color: #64748b;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            color: white;
        }

        body.light-theme .nav-item:hover {
            background: rgba(0, 0, 0, 0.05);
            border-color: rgba(0, 0, 0, 0.1);
            color: #1e293b;
        }

        .nav-item.active {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã */
        .theme-toggle-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #bbdefb;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: inherit;
            font-size: 0.9rem;
            transition: all 0.3s;
            margin-left: 0.5rem;
        }

        body.light-theme .theme-toggle-btn {
            background: rgba(0, 0, 0, 0.05);
            color: #64748b;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .theme-toggle-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        body.light-theme .theme-toggle-btn:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        /* –ö–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ */
        .admin-mode-btn {
            background: linear-gradient(45deg, #8b5cf6, #7c3aed);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
            cursor: pointer;
            text-decoration: none;
            border: 1px solid rgba(139, 92, 246, 0.3);
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.3);
        }

        .admin-mode-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.4);
            background: linear-gradient(45deg, #7c3aed, #6d28d9);
        }

        /* –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ */
        .logout-btn {
            background: linear-gradient(45deg, #ef4444, #dc2626);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
            cursor: pointer;
            text-decoration: none;
            border: 1px solid rgba(239, 68, 68, 0.3);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
        }

        .logout-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
            background: linear-gradient(45deg, #dc2626, #b91c1c);
        }

        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ... */
        .stats-container {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 3rem 0;
            flex-wrap: wrap;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.07);
            border-radius: 20px;
            padding: 2rem;
            min-width: 200px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        body.light-theme .stat-card {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .stat-card:hover {
            transform: translateY(-10px);
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(96, 165, 250, 0.3);
        }

        body.light-theme .stat-card:hover {
            background: rgba(255, 255, 255, 0.9);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 800;
            color: #4ade80;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 20px rgba(74, 222, 128, 0.5);
        }

        .stat-label {
            font-size: 1.1rem;
            color: #bbdefb;
        }

        body.light-theme .stat-label {
            color: #64748b;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã */
        .mode-card-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            margin-top: -1rem;
            margin-bottom: 3rem;
        }

        .mode-card {
            background: rgba(255, 255, 255, 0.07);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 1.5rem 2rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        body.light-theme .mode-card {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .mode-card:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(96, 165, 250, 0.3);
            transform: translateY(-2px);
        }

        body.light-theme .mode-card:hover {
            background: rgba(255, 255, 255, 0.9);
        }

        .mode-status {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .mode-icon {
            font-size: 2rem;
        }

        .mode-text {
            font-size: 1.3rem;
            font-weight: 600;
            color: #fff;
        }

        body.light-theme .mode-text {
            color: #1e293b;
        }

        .mode-details {
            display: flex;
            gap: 2rem;
        }

        .mode-item {
            text-align: center;
        }

        .mode-label {
            display: block;
            color: #bbdefb;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        body.light-theme .mode-label {
            color: #64748b;
        }

        .mode-value {
            display: block;
            font-size: 1.1rem;
            font-weight: 600;
            color: #4ade80;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π */
        .feature-card-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
            max-width: 1200px;
            width: 100%;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.07);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 2.5rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s;
        }

        body.light-theme .feature-card {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .feature-card:hover {
            transform: translateY(-10px);
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(96, 165, 250, 0.3);
        }

        body.light-theme .feature-card:hover {
            background: rgba(255, 255, 255, 0.9);
        }

        .feature-icon {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            display: block;
        }

        .feature-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #fff;
            background: linear-gradient(45deg, #bbdefb, #90caf9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        body.light-theme .feature-title {
            background: linear-gradient(45deg, #1d4ed8, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .feature-description {
            color: #bbdefb;
            line-height: 1.6;
        }

        body.light-theme .feature-description {
            color: #64748b;
        }

        /* –°–µ–∫—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
        .users-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 25px;
            padding: 3rem;
            margin: 3rem auto;
            max-width: 1200px;
            width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        body.light-theme .users-section {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 2rem;
            background: linear-gradient(45deg, #60a5fa, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        body.light-theme .section-title {
            background: linear-gradient(45deg, #1d4ed8, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* –°–µ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .user-card {
            background: rgba(255, 255, 255, 0.07);
            border-radius: 16px;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.25rem;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        body.light-theme .user-card {
            background: rgba(255, 255, 255, 0.9);
        }

        .user-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(96, 165, 250, 0.3);
        }

        body.light-theme .user-card:hover {
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        /* –ì—Ä–∞—Ñ–∏–∫–∏ */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.07);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        body.light-theme .chart-card {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #fff;
            text-align: center;
        }

        body.light-theme .chart-title {
            color: #1e293b;
        }

        .chart-wrapper {
            height: 250px;
            position: relative;
        }

        /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
        .action-button {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.8rem;
            transition: all 0.3s;
            text-decoration: none;
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .action-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.4);
        }

        .action-button.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #bbdefb;
        }

        body.light-theme .action-button.secondary {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #64748b;
        }

        .action-button.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        body.light-theme .action-button.secondary:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        /* –§—É—Ç–µ—Ä */
        .footer {
            margin-top: 4rem;
            padding: 3rem 0;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.light-theme .footer {
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .footer-logo {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #60a5fa, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.light-theme .footer-logo {
            background: linear-gradient(45deg, #1d4ed8, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 1.5rem 0;
            flex-wrap: wrap;
        }

        .footer-link {
            color: #bbdefb;
            text-decoration: none;
            transition: color 0.3s;
        }

        body.light-theme .footer-link {
            color: #64748b;
        }

        .footer-link:hover {
            color: white;
        }

        body.light-theme .footer-link:hover {
            color: #1d4ed8;
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è */
        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 1000;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }
        
        .connection-status.connected {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        .connection-status.disconnected {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .connection-status.reconnecting {
            background: rgba(251, 191, 36, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }
        
        .connection-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .connection-status.connected .connection-dot {
            background: #4ade80;
            animation: pulse 2s infinite;
        }
        
        .connection-status.disconnected .connection-dot {
            background: #ef4444;
        }
        
        .connection-status.reconnecting .connection-dot {
            background: #f59e0b;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>

<body>
    <!-- –ó–≤–µ–∑–¥–Ω–æ–µ –Ω–µ–±–æ -->
    <div class="stars" id="stars"></div>

    <!-- –ü–ª–∞–Ω–µ—Ç–∞ -->
    <div class="planet"></div>
    
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
    <div class="connection-status" id="connectionStatus">
        <span class="connection-dot"></span>
        <span>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="container">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="nav-menu">
            <a href="index.html" class="nav-item active">
                <i class="fas fa-home"></i>
                <span>–ì–ª–∞–≤–Ω–∞—è</span>
            </a>
            <a href="about.html" class="nav-item">
                <i class="fas fa-info-circle"></i>
                <span>–û –ø—Ä–æ–µ–∫—Ç–µ</span>
            </a>
            <a href="presentation.html" class="nav-item">
                <i class="fas fa-presentation"></i>
                <span>–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è</span>
            </a>

            <!-- –≠—Ç–∞ –∫–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É -->
            <a href="#" class="nav-item admin-mode-btn" id="adminModeToggle" onclick="toggleServerMode(); return false;"
                style="display: none;">
                <i class="fas fa-cogs"></i>
                <span>–†–µ–∂–∏–º: –°–µ—Ä–≤–µ—Ä–Ω—ã–π</span>
            </a>

            <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞) -->
            <a href="#" class="nav-item logout-btn" id="logoutBtn" onclick="logoutAdmin(); return false;"
                style="display: none;">
                <i class="fas fa-sign-out-alt"></i>
                <span>–í—ã–π—Ç–∏</span>
            </a>

            <!-- –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞ (–¥–ª—è –≤—Å–µ—Ö) -->
            <a href="#" class="nav-item" onclick="clearCache(); return false;">
                <i class="fas fa-sync-alt"></i>
                <span>–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à</span>
            </a>

            <!-- –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
            <a href="#" class="nav-item" onclick="showAdminLoginModal(); return false;">
                <i class="fas fa-user-shield"></i>
                <span>–í—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</span>
            </a>

            <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã -->
            <button class="theme-toggle-btn" onclick="toggleTheme()">
                <i class="fas fa-moon" id="themeIcon"></i>
                <span id="themeText">–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</span>
            </button>
        </nav>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="centered-container">
            <div class="main-title-container">
                <h1 class="main-title">UserManager Pro</h1>
                <p class="main-subtitle">
                    –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è CRM —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Ä–µ–∂–∏–º–æ–≤
                </p>
            </div>

            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã -->
            <div class="mode-card-container">
                <div class="mode-card">
                    <div class="mode-status">
                        <div class="mode-icon">
                            <i class="fas fa-server"></i>
                        </div>
                        <div class="mode-text" id="currentModeText">
                            –†–µ–∂–∏–º: –ó–∞–≥—Ä—É–∑–∫–∞...
                        </div>
                    </div>
                    <div class="mode-details">
                        <div class="mode-item">
                            <span class="mode-label">–°—Ç–∞—Ç—É—Å</span>
                            <span class="mode-value" id="statusValue">...</span>
                        </div>
                        <div class="mode-item">
                            <span class="mode-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
                            <span class="mode-value" id="usersValue">...</span>
                        </div>
                        <div class="mode-item">
                            <span class="mode-label">–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</span>
                            <span class="mode-value" id="clientsValue">...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-number" id="totalUsers">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeUsers">0</div>
                    <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="uptime">100%</div>
                    <div class="stat-label">–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å</div>
                </div>
            </div>

            <!-- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
            <div class="feature-card-container">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-users-cog"></i>
                    </div>
                    <h3 class="feature-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                    <p class="feature-description">
                        –°–æ–∑–¥–∞–≤–∞–π—Ç–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏ —É–¥–∞–ª—è–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —É–¥–æ–±–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö
                        —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3 class="feature-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã</h3>
                    <p class="feature-description">
                        –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3 class="feature-title">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
                    <p class="feature-description">
                        –ù–∞–¥–µ–∂–Ω–∞—è –∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ –¥–æ—Å—Ç—É–ø–∞ –∏ –∞–¥–º–∏–Ω—Å–∫–∏–º–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏.
                    </p>
                </div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div class="users-section">
                <h2 class="section-title">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
                <div class="users-grid" id="usersGrid">
                    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>

            <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
            <div class="charts-container">
                <div class="chart-card">
                    <h3 class="chart-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º</h3>
                    <div class="chart-wrapper">
                        <canvas id="activityChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                    <div class="chart-wrapper">
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- –§—É—Ç–µ—Ä -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-logo">UserManager Pro</div>
                <div class="footer-links">
                    <a href="index.html" class="footer-link">–ì–ª–∞–≤–Ω–∞—è</a>
                    <a href="about.html" class="footer-link">–û –ø—Ä–æ–µ–∫—Ç–µ</a>
                    <a href="presentation.html" class="footer-link">–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è</a>
                    <a href="https://github.com/Dmitriy43229/Go-Project777_GoStory" class="footer-link">GitHub</a>
                </div>
                <p>¬© 2024 UserManager Pro. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </footer>
    </div>

    <script>
        // ============================ –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ============================
        let ws = null;
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 10;
        let isReloading = false;
        let isAdmin = false;
        let currentServerMode = "server";
        
        // ============================ –§–£–ù–ö–¶–ò–ò –î–õ–Ø –¢–ï–ú–´ ============================
        function initTheme() {
            const savedTheme = localStorage.getItem('usermanager_theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
                updateThemeIcon(true);
            } else {
                document.body.classList.remove('light-theme');
                updateThemeIcon(false);
            }
            createStars(); // –°–æ–∑–¥–∞–µ–º –∑–≤–µ–∑–¥—ã –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–º—ã
        }
        
        function toggleTheme() {
            const isLight = document.body.classList.toggle('light-theme');
            localStorage.setItem('usermanager_theme', isLight ? 'light' : 'dark');
            updateThemeIcon(isLight);
            createStars(); // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –∑–≤–µ–∑–¥—ã –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–º—ã
        }
        
        function updateThemeIcon(isLight) {
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');
            if (themeIcon && themeText) {
                if (isLight) {
                    themeIcon.className = 'fas fa-sun';
                    themeText.textContent = '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
                } else {
                    themeIcon.className = 'fas fa-moon';
                    themeText.textContent = '–¢–µ–º–Ω–∞—è —Ç–µ–º–∞';
                }
            }
        }
        
        // ============================ –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ó–í–ï–ó–î ============================
        function createStars() {
            const starsContainer = document.getElementById('stars');
            if (!starsContainer) return;
            
            // –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
            if (document.body.classList.contains('light-theme')) {
                starsContainer.innerHTML = '';
                return;
            }
            
            starsContainer.innerHTML = '';
            const starCount = 150;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                const size = Math.random() * 3 + 1;
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                const duration = Math.random() * 5 + 3;
                const delay = Math.random() * 5;
                
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${x}%`;
                star.style.top = `${y}%`;
                star.style.setProperty('--duration', `${duration}s`);
                star.style.setProperty('--delay', `${delay}s`);
                
                starsContainer.appendChild(star);
            }
        }
        
        // ============================ –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê ============================
        function checkAdminAccess() {
            const savedAdmin = localStorage.getItem('usermanager_admin_session');
            const expiry = localStorage.getItem('usermanager_admin_expiry');
            
            if (savedAdmin && expiry) {
                if (Date.now() < parseInt(expiry)) {
                    isAdmin = true;
                    return true;
                } else {
                    // –û—á–∏—â–∞–µ–º –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é
                    localStorage.removeItem('usermanager_admin_session');
                    localStorage.removeItem('usermanager_admin_expiry');
                    isAdmin = false;
                    return false;
                }
            }
            isAdmin = false;
            return false;
        }
        
        function updateAdminButtons() {
            const adminBtn = document.getElementById('adminModeToggle');
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (adminBtn && logoutBtn) {
                if (isAdmin) {
                    adminBtn.style.display = 'flex';
                    logoutBtn.style.display = 'flex';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞
                    adminBtn.innerHTML = `
                        <i class="fas fa-cogs"></i>
                        <span>–†–µ–∂–∏–º: ${currentServerMode === 'local' ? '–õ–æ–∫–∞–ª—å–Ω—ã–π' : '–°–µ—Ä–≤–µ—Ä–Ω—ã–π'}</span>
                    `;
                } else {
                    adminBtn.style.display = 'none';
                    logoutBtn.style.display = 'none';
                }
            }
        }
        
        function showAdminLoginModal() {
            const password = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:');
            if (password === "admin123") {
                // –°–æ–∑–¥–∞–µ–º —Å–µ—Å—Å–∏—é
                const sessionId = 'admin_' + Date.now();
                const expiryTime = Date.now() + (24 * 60 * 60 * 1000);
                
                localStorage.setItem('usermanager_admin_session', sessionId);
                localStorage.setItem('usermanager_admin_expiry', expiryTime.toString());
                
                isAdmin = true;
                alert('‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä!');
                updateAdminButtons();
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                setTimeout(() => location.reload(true), 1000);
                
            } else if (password !== null) {
                alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
            }
        }
        
        function logoutAdmin() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞?')) {
                // –û—á–∏—â–∞–µ–º —Å–µ—Å—Å–∏—é
                localStorage.removeItem('usermanager_admin_session');
                localStorage.removeItem('usermanager_admin_expiry');
                
                isAdmin = false;
                updateAdminButtons();
                alert('‚úÖ –í—ã –≤—ã—à–ª–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.');
                
                setTimeout(() => location.reload(true), 1000);
            }
        }
        
        async function toggleServerMode() {
            if (!isAdmin) {
                showAdminLoginModal();
                return;
            }
            
            try {
                const newMode = currentServerMode === "server" ? "local" : "server";
                const modeName = newMode === "server" ? "–°–µ—Ä–≤–µ—Ä–Ω—ã–π" : "–õ–æ–∫–∞–ª—å–Ω—ã–π";
                
                console.log(`üîÑ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º –Ω–∞: ${newMode}`);
                
                const response = await fetch('http://localhost:8068/api/admin/mode', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Admin-Password': 'admin123'
                    },
                    body: JSON.stringify({
                        mode: newMode,
                        password: 'admin123'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                    currentServerMode = newMode;
                    updateCurrentMode(newMode);
                    updateAdminButtons();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    if (newMode === 'local') {
                        alert(`‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –≤–∫–ª—é—á–µ–Ω!\n\n–í–°–ï –û–ë–´–ß–ù–´–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò –°–ï–ô–ß–ê–° –ñ–ï –£–í–ò–î–Ø–¢ –ë–ï–õ–£–Æ –°–¢–†–ê–ù–ò–¶–£ 404!\n\n–¢–æ–ª—å–∫–æ –≤—ã (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä) –º–æ–∂–µ—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Å–∏—Å—Ç–µ–º–æ–π.\n\nüì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${data.clients || 0}`);
                    } else {
                        alert(`‚úÖ –°–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º –≤–∫–ª—é—á–µ–Ω!\n\n–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ–ø–µ—Ä—å –≤–∏–¥—è—Ç –æ–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ.\n\nüì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: ${data.clients || 0}`);
                    }
                    
                    // –ù–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É - WebSocket –æ–±–Ω–æ–≤–∏—Ç –≤—Å—ë –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                    
                } else {
                    const error = await response.json();
                    throw new Error(error.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞:', error);
                alert(`‚ùå –û—à–∏–±–∫–∞: ${error.message}\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–∞ localhost:8068`);
            }
        }
        
        // ============================ WEBSOCKET –ò –†–ï–ñ–ò–ú–´ ============================
        function updateConnectionStatus(status) {
            const statusEl = document.getElementById('connectionStatus');
            if (!statusEl) return;
            
            statusEl.className = `connection-status ${status}`;
            
            switch(status) {
                case 'connected':
                    statusEl.innerHTML = '<span class="connection-dot"></span><span>–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</span>';
                    reconnectAttempts = 0;
                    break;
                case 'disconnected':
                    statusEl.innerHTML = '<span class="connection-dot"></span><span>–û—Ç–∫–ª—é—á–µ–Ω–æ</span>';
                    break;
                case 'reconnecting':
                    statusEl.innerHTML = '<span class="connection-dot"></span><span>–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>';
                    break;
            }
        }
        
        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.hostname}:8068/ws`;
            
            try {
                ws = new WebSocket(wsUrl);
                
                ws.onopen = function() {
                    console.log('‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω');
                    updateConnectionStatus('connected');
                };
                
                ws.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        console.log('üì® WebSocket —Å–æ–æ–±—â–µ–Ω–∏–µ:', data);
                        
                        switch(data.type) {
                            case 'connected':
                                console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —Ä–µ–∂–∏–º:', data.data.mode);
                                currentServerMode = data.data.mode;
                                updateCurrentMode(data.data.mode);
                                updateClientsCount(data.data.clients);
                                break;
                                
                            case 'mode_changed':
                                console.log('üîÑ –†–µ–∂–∏–º –∏–∑–º–µ–Ω–∏–ª—Å—è:', data.data.old_mode, '‚Üí', data.data.new_mode);
                                currentServerMode = data.data.new_mode;
                                updateCurrentMode(data.data.new_mode);
                                updateAdminButtons();
                                
                                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                                if (isAdmin) {
                                    if (data.data.new_mode === 'local') {
                                        alert(`üîÑ –†–µ–∂–∏–º –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ –õ–û–ö–ê–õ–¨–ù–´–ô\n\n–¢–æ–ª—å–∫–æ –≤—ã (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä) –≤–∏–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ.\n\n–í—Å–µ –æ–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–µ–π—á–∞—Å –∂–µ —É–≤–∏–¥—è—Ç –±–µ–ª—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É 404.`);
                                    } else {
                                        alert(`üîÑ –†–µ–∂–∏–º –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ –°–ï–†–í–ï–†–ù–´–ô\n\n–¢–µ–ø–µ—Ä—å –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –æ–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ.`);
                                    }
                                }
                                
                                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                                if (data.data.force_reload && !isReloading) {
                                    isReloading = true;
                                    setTimeout(() => {
                                        console.log('üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑-–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞');
                                        location.reload(true);
                                    }, 2000);
                                }
                                break;
                                
                            case 'force_reload':
                                console.log('‚ö° –ü–æ–ª—É—á–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –Ω–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É');
                                if (!isReloading) {
                                    isReloading = true;
                                    setTimeout(() => {
                                        location.reload(true);
                                    }, 1500);
                                }
                                break;
                                
                            case 'ping':
                                // –û—Ç–≤–µ—á–∞–µ–º –Ω–∞ ping
                                if (ws.readyState === WebSocket.OPEN) {
                                    ws.send(JSON.stringify({ type: 'pong' }));
                                }
                                break;
                                
                            case 'clients_update':
                                updateClientsCount(data.data.clients);
                                break;
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ WebSocket —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
                    }
                };
                
                ws.onclose = function(event) {
                    console.log('‚ùå WebSocket –æ—Ç–∫–ª—é—á–µ–Ω:', event.code, event.reason);
                    updateConnectionStatus('disconnected');
                    
                    // –ü—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
                    if (reconnectAttempts < maxReconnectAttempts) {
                        reconnectAttempts++;
                        const delay = Math.min(1000 * reconnectAttempts, 10000);
                        
                        console.log(`üîÑ –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ${reconnectAttempts}/${maxReconnectAttempts} —á–µ—Ä–µ–∑ ${delay}–º—Å`);
                        updateConnectionStatus('reconnecting');
                        
                        setTimeout(() => {
                            connectWebSocket();
                        }, delay);
                    }
                };
                
                ws.onerror = function(error) {
                    console.error('‚ùå WebSocket –æ—à–∏–±–∫–∞:', error);
                    updateConnectionStatus('disconnected');
                };
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è WebSocket:', error);
                updateConnectionStatus('disconnected');
            }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º
        function updateCurrentMode(mode) {
            const modeText = document.getElementById('currentModeText');
            const statusValue = document.getElementById('statusValue');
            
            if (modeText) {
                modeText.textContent = `–†–µ–∂–∏–º: ${mode === 'local' ? '–õ–æ–∫–∞–ª—å–Ω—ã–π' : '–°–µ—Ä–≤–µ—Ä–Ω—ã–π'}`;
                modeText.style.color = mode === 'local' ? '#f59e0b' : '#4ade80';
            }
            
            if (statusValue) {
                statusValue.textContent = mode === 'server' ? '–û–Ω–ª–∞–π–Ω' : '–õ–æ–∫–∞–ª—å–Ω–æ';
                statusValue.style.color = mode === 'server' ? '#4ade80' : '#f59e0b';
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            localStorage.setItem('current_server_mode', mode);
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
        function updateClientsCount(count) {
            const clientsValue = document.getElementById('clientsValue');
            if (clientsValue) {
                clientsValue.textContent = count;
            }
        }
        
        // ============================ –î–†–£–ì–ò–ï –§–£–ù–ö–¶–ò–ò ============================
        function clearCache() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É?')) {
                localStorage.clear();
                sessionStorage.clear();
                
                if ('caches' in window) {
                    caches.keys().then(function(names) {
                        for (let name of names) {
                            caches.delete(name);
                        }
                    });
                }
                
                alert('‚úÖ –í–µ—Å—å –∫–µ—à –æ—á–∏—â–µ–Ω. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∞.');
                
                setTimeout(() => {
                    window.location.href = window.location.pathname + '?nocache=' + Date.now();
                }, 1000);
            }
        }
        
        // ============================ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ============================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–µ–º—É
            initTheme();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–¥–º–∏–Ω—Å–∫–∏–π –¥–æ—Å—Ç—É–ø
            checkAdminAccess();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω–∞
            updateAdminButtons();
            
            // –ü–æ–¥–∫–ª—é—á–∞–µ–º WebSocket
            connectWebSocket();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            loadInitialData();
            
            // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
            createCharts();
        });
        
        async function loadInitialData() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º —Å–µ—Ä–≤–µ—Ä–∞
                const response = await fetch('http://localhost:8068/api/status?_=' + Date.now());
                if (response.ok) {
                    const data = await response.json();
                    currentServerMode = data.mode;
                    updateCurrentMode(data.mode);
                    updateClientsCount(data.clients || 0);
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    const statsResponse = await fetch('http://localhost:8068/api/stats?_=' + Date.now());
                    if (statsResponse.ok) {
                        const stats = await statsResponse.json();
                        updateStats(stats);
                    }
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    loadUsers();
                }
            } catch (error) {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                updateCurrentMode('server');
                updateClientsCount(1);
                displayLocalUsers();
            }
        }
        
        function updateStats(stats) {
            const totalUsersEl = document.getElementById('totalUsers');
            const activeUsersEl = document.getElementById('activeUsers');
            const usersValueEl = document.getElementById('usersValue');
            
            if (totalUsersEl) totalUsersEl.textContent = stats.total_users || 0;
            if (activeUsersEl) activeUsersEl.textContent = stats.total_users || 0;
            if (usersValueEl) usersValueEl.textContent = stats.total_users || 0;
        }
        
        async function loadUsers() {
            try {
                const response = await fetch('http://localhost:8068/api/users?_=' + Date.now());
                if (response.ok) {
                    const users = await response.json();
                    displayUsers(users);
                }
            } catch (error) {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Å–µ—Ä–≤–µ—Ä–∞:', error);
                displayLocalUsers();
            }
        }
        
        function displayLocalUsers() {
            const localUsers = [
                { id: 1, name: '–ê–ª–µ–∫—Å–µ–π –ò–≤–∞–Ω–æ–≤', email: 'alex@example.com', created_at: new Date(Date.now() - 72 * 3600000).toISOString() },
                { id: 2, name: '–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞', email: 'maria@example.com', created_at: new Date(Date.now() - 48 * 3600000).toISOString() },
                { id: 3, name: '–ò–≤–∞–Ω –°–∏–¥–æ—Ä–æ–≤', email: 'ivan@company.ru', created_at: new Date(Date.now() - 24 * 3600000).toISOString() }
            ];
            displayUsers(localUsers);
        }
        
        function displayUsers(users) {
            const usersGrid = document.getElementById('usersGrid');
            if (!usersGrid) return;
            
            usersGrid.innerHTML = '';
            
            if (users.length === 0) {
                usersGrid.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #94a3b8; grid-column: 1 / -1;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">üì≠</div>
                        <h3 style="color: #64748b; margin-bottom: 1rem;">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                        <p>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞.</p>
                    </div>
                `;
                return;
            }
            
            users.forEach(user => {
                const userCard = document.createElement('div');
                userCard.className = 'user-card';
                
                const createdDate = new Date(user.created_at);
                const formattedDate = createdDate.toLocaleDateString('ru-RU');
                
                userCard.innerHTML = `
                    <div style="width: 50px; height: 50px; background: linear-gradient(45deg, #3b82f6, #1d4ed8); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.2rem;">
                        ${user.name.charAt(0)}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: white; margin-bottom: 0.25rem;">${user.name}</div>
                        <div style="color: #bbdefb; font-size: 0.9rem; margin-bottom: 0.5rem;">${user.email}</div>
                        <div style="color: #94a3b8; font-size: 0.8rem;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${formattedDate}</div>
                    </div>
                `;
                
                usersGrid.appendChild(userCard);
            });
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
        function createCharts() {
            // –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            const activityCtx = document.getElementById('activityChart')?.getContext('2d');
            if (activityCtx) {
                new Chart(activityCtx, {
                    type: 'line',
                    data: {
                        labels: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'],
                        datasets: [{
                            label: '–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π',
                            data: [12, 19, 15, 22, 18, 16, 20],
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: document.body.classList.contains('light-theme') ? '#334155' : '#e2e8f0'
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    color: document.body.classList.contains('light-theme') ? '#64748b' : '#94a3b8'
                                },
                                grid: {
                                    color: document.body.classList.contains('light-theme') ? 'rgba(0, 0, 0, 0.1)' : 'rgba(255, 255, 255, 0.1)'
                                }
                            },
                            y: {
                                ticks: {
                                    color: document.body.classList.contains('light-theme') ? '#64748b' : '#94a3b8'
                                },
                                grid: {
                                    color: document.body.classList.contains('light-theme') ? 'rgba(0, 0, 0, 0.1)' : 'rgba(255, 255, 255, 0.1)'
                                }
                            }
                        }
                    }
                });
            }
            
            // –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
            const distributionCtx = document.getElementById('distributionChart')?.getContext('2d');
            if (distributionCtx) {
                new Chart(distributionCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã', '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏', '–ì–æ—Å—Ç–∏'],
                        datasets: [{
                            data: [1, 3, 15, 42],
                            backgroundColor: [
                                '#3b82f6',
                                '#8b5cf6',
                                '#10b981',
                                '#64748b'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: document.body.classList.contains('light-theme') ? '#334155' : '#e2e8f0',
                                    padding: 20
                                }
                            }
                        }
                    }
                });
            }
        }
    </script>
</body>
</html>