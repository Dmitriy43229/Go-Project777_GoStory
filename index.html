<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UserManager - –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π CRM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* --- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–º–∏–∑–∞—Ü–∏–∏ --- */
        :root {
            --bg-primary: #0a192f;
            --bg-secondary: #112240;
            --accent-blue: #3b82f6;
            --accent-blue-dark: #1d4ed8;
            --accent-green: #4ade80;
            --text-primary: #e2e8f0;
            --text-secondary: #bbdefb;
            --border-light: rgba(255, 255, 255, 0.1);
            --shadow-primary: rgba(59, 130, 246, 0.3);
            --card-bg: rgba(255, 255, 255, 0.07);
            --card-hover-bg: rgba(255, 255, 255, 0.1);
            --transition: all 0.3s ease;
            --transition-bg: background 0.5s ease, color 0.5s ease;
        }

        /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
        .light-theme {
            --bg-primary: #f8fafc;
            --bg-secondary: #f1f5f9;
            --accent-green: #059669;
            --text-primary: #334155;
            --text-secondary: #64748b;
            --border-light: rgba(0, 0, 0, 0.1);
            --shadow-primary: rgba(0, 0, 0, 0.15);
            --card-bg: rgba(255, 255, 255, 0.9);
            --card-hover-bg: rgba(255, 255, 255, 0.95);
        }

        /* –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω */
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary), var(--bg-primary));
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            transition: var(--transition-bg);
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* –ó–≤–µ–∑–¥—ã */
        .stars, .star {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        .star {
            background: white;
            border-radius: 50%;
            animation: twinkle calc(var(--duration) * 1s) infinite var(--delay);
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        /* –ü–ª–∞–Ω–µ—Ç–∞ */
        .planet {
            position: fixed;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, var(--accent-blue), var(--accent-blue-dark));
            box-shadow: inset -20px -20px 40px rgba(0,0,0,0.5), 0 0 80px var(--shadow-primary);
            top: 10%;
            right: 5%;
            z-index: 0;
            opacity: 0.7;
            animation: float 20s infinite ease-in-out;
        }
        .light-theme .planet { opacity: 0.3; }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(120deg); }
            66% { transform: translateY(20px) rotate(240deg); }
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∏ —ç–ª–µ–º–µ–Ω—Ç—ã */
        .main-title-container, .stat-card, .feature-card, .users-section, .chart-card, .mode-card {
            background: var(--card-bg);
            border: 1px solid var(--border-light);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            transition: var(--transition);
        }

        .stat-card:hover, .feature-card:hover, .user-card:hover, .mode-card:hover {
            transform: translateY(-5px);
            background: var(--card-hover-bg);
        }

        .main-title {
            background: linear-gradient(45deg, #60a5fa, var(--accent-blue), var(--accent-blue-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .section-title {
            background: linear-gradient(45deg, #60a5fa, var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .feature-title {
            background: linear-gradient(45deg, var(--text-secondary), #90caf9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-number { color: var(--accent-green); }

        .action-button {
            background: linear-gradient(45deg, var(--accent-blue), var(--accent-blue-dark));
            box-shadow: 0 10px 25px var(--shadow-primary);
            transition: var(--transition);
        }
        .action-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px var(--shadow-primary);
        }

        /* –ü–æ–∏—Å–∫ */
        .search-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
        }
        .search-container::before {
            color: var(--text-secondary);
        }

        /* –°–ò–°–¢–ï–ú–ê –î–û–°–¢–£–ü–ê - –Ω–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
        .nav-menu {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin: 2rem 0;
            flex-wrap: wrap;
            align-items: center;
        }

        .nav-item {
            color: var(--text-secondary);
            text-decoration: none;
            padding: 0.8rem 1.2rem;
            border-radius: 12px;
            transition: var(--transition);
            font-weight: 500;
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .nav-item.active {
            background: linear-gradient(45deg, var(--accent-blue), var(--accent-blue-dark));
            color: white;
            box-shadow: 0 5px 15px var(--shadow-primary);
        }

        .login-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            font-family: inherit;
            font-size: 0.85rem;
            text-decoration: none;
        }

        .login-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .login-btn.admin {
            background: rgba(245, 158, 11, 0.2);
            border-color: rgba(245, 158, 11, 0.4);
            color: #fbbf24;
            font-weight: 600;
        }

        .api-mode-btn {
            display: none;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            border-radius: 20px;
            color: #93c5fd;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
        }

        .api-mode-btn:hover {
            background: rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
        }

        .api-mode-btn.local {
            background: rgba(139, 92, 246, 0.2);
            border-color: rgba(139, 92, 246, 0.4);
            color: #a78bfa;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
        .stats-control-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border-light);
            flex-wrap: wrap;
            gap: 1rem;
            animation: fadeIn 0.5s ease;
        }

        .live-stats {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .live-stats .stat-item {
            text-align: center;
        }

        .live-stats .stat-number {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--accent-green);
            line-height: 1;
            margin-bottom: 0.25rem;
        }

        .live-stats .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .chart-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .last-update {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .chart-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .login-modal.active {
            display: flex;
        }

        .login-container {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.98), rgba(30, 41, 59, 0.98));
            border-radius: 24px;
            padding: 2.5rem;
            width: 90%;
            max-width: 400px;
            border: 2px solid rgba(96, 165, 250, 0.25);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
            position: relative;
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-icon {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            display: block;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-subtitle {
            color: #94a3b8;
            font-size: 0.95rem;
        }

        .password-input {
            width: 100%;
            padding: 1rem 1.5rem;
            background: rgba(255, 255, 255, 0.07);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s;
            outline: none;
            text-align: center;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
        }

        .password-input:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 0 4px rgba(96, 165, 250, 0.2);
        }

        .password-hint {
            text-align: center;
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 1.5rem;
        }

        .login-actions {
            display: flex;
            gap: 1rem;
        }

        .login-btn-primary, .login-btn-secondary {
            flex: 1;
            padding: 0.9rem;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .login-btn-primary {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .login-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(59, 130, 246, 0.6);
        }

        .login-btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #cbd5e1;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .login-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .login-error {
            color: #f87171;
            margin-top: 1rem;
            text-align: center;
            font-size: 0.9rem;
            padding: 0.75rem;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(239, 68, 68, 0.2);
            display: none;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —Å–ø–∏–Ω–Ω–µ—Ä–∞ */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 0.75rem 1.25rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 10001;
            animation: slideIn 0.3s ease;
            max-width: 300px;
            word-break: break-word;
            color: white;
        }

        .notification.success { background: #10b981; }
        .notification.error { background: #ef4444; }
        .notification.warning { background: #f59e0b; }
        .notification.info { background: #3b82f6; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤ */
        @media (max-width: 768px) {
            .planet { display: none; }
            .mode-card { flex-direction: column; text-align: center; }
            .mode-details { flex-direction: column; }
            .users-section > div:first-of-type {
                flex-direction: column;
                align-items: stretch;
            }
            .users-section .action-button { width: 100%; }
            
            .stats-control-panel {
                flex-direction: column;
                text-align: center;
            }
            
            .live-stats {
                justify-content: center;
                gap: 1.5rem;
            }
            
            .chart-controls {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .login-actions {
                flex-direction: column;
            }
            
            .nav-menu {
                flex-direction: column;
                gap: 0.8rem;
            }
        }
    </style>
</head>

<body class="index-page">
    <div class="stars" id="stars"></div>
    <div class="planet"></div>

    <div class="container">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="nav-menu">
            <a href="index.html" class="nav-item active">üè† –ì–ª–∞–≤–Ω–∞—è</a>
            <a href="about.html" class="nav-item">üìñ –û –ø—Ä–æ–µ–∫—Ç–µ</a>
            <a href="presentation.html" class="nav-item">üé¨ –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è</a>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞/–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
            <button class="login-btn" onclick="showLoginModal()" id="loginButton">
                <span>üîê</span> <span>–í–æ–π—Ç–∏</span>
            </button>
            
            <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞) -->
            <button class="api-mode-btn" onclick="toggleApiMode()" id="apiModeButton" style="display: none;">
                <span id="apiModeIcon">üåê</span> <span id="apiModeText">–°–µ—Ä–≤–µ—Ä–Ω—ã–π</span>
            </button>
            
            <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
            <button class="theme-toggle" id="themeToggle">
                <span id="themeIcon">üåô</span> <span id="themeText">–¢–µ–º–Ω–∞—è</span>
            </button>
        </div>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <section class="main-title-container">
            <div style="font-size: 4rem;">üë•</div>
            <h1 class="main-title">UserManager Pro</h1>
            <p class="main-subtitle">
                –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º,
                –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏ –±–µ–∑—É–ø—Ä–µ—á–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
            </p>
        </section>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <section class="stats-container">
            <div class="stat-card">
                <div class="stat-number" id="totalUsers">0</div>
                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="apiResponseTime">50ms</div>
                <div class="stat-label">–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">100%</div>
                <div class="stat-label">–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">24/7</div>
                <div class="stat-label">–†–∞–±–æ—Ç–∞</div>
            </div>
        </section>

        <!-- –†–µ–∂–∏–º -->
        <div class="mode-card-container">
            <div class="mode-card" id="modeCard">
                <div class="mode-status">
                    <span class="mode-icon" id="modeIcon">üåê</span>
                    <span class="mode-text" id="modeText">–°–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º</span>
                </div>
                <div class="mode-details">
                    <div class="mode-item">
                        <span class="mode-label">–°—Ç–∞—Ç—É—Å:</span>
                        <span class="mode-value" id="serverStatus">üü¢ –û–Ω–ª–∞–π–Ω</span>
                    </div>
                    <div class="mode-item">
                        <span class="mode-label">–û—Ç–≤–µ—Ç:</span>
                        <span class="mode-value" id="realResponseTime">50ms</span>
                    </div>
                    <div class="mode-item">
                        <span class="mode-label">–û–±–Ω–æ–≤–ª–µ–Ω–æ:</span>
                        <span class="mode-value" id="lastUpdate">21:45</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ -->
        <section class="centered-container">
            <h2 class="section-title">‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h2>
            <div class="feature-card-container">
                <div class="feature-card"><span class="feature-icon">üöÄ</span>
                    <h3 class="feature-title">–°–∫–æ—Ä–æ—Å—Ç—å</h3>
                    <p class="feature-description">–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤</p>
                </div>
                <div class="feature-card"><span class="feature-icon">üîí</span>
                    <h3 class="feature-title">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
                    <p class="feature-description">–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö</p>
                </div>
                <div class="feature-card"><span class="feature-icon">üì±</span>
                    <h3 class="feature-title">–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
                    <p class="feature-description">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</p>
                </div>
            </div>
        </section>

        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ -->
        <section class="users-section">
            <h2 class="section-title">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
            <div style="display:flex;justify-content:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap;align-items:center;">
                <div class="search-container">
                    <input type="text" id="searchInput" class="search-input" placeholder="–ü–æ–∏—Å–∫..."
                           onkeyup="searchUsers(this.value)">
                </div>
                <button class="action-button secondary" onclick="loadUsers()">
                    <span>üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
            <div class="users-grid" id="usersGrid"></div>
            <div class="empty-state" id="emptyState">
                <div style="font-size:4rem;">üë§</div>
                <h3>–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
                <button class="action-button" onclick="openModal()" style="margin-top:1rem;">
                    –î–æ–±–∞–≤–∏—Ç—å
                </button>
            </div>
        </section>

        <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô –ò –ì–†–ê–§–ò–ö -->
        <section class="centered-container">
            <h2 class="section-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>
            
            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π -->
            <div class="stats-control-panel">
                <div class="live-stats">
                    <div class="stat-item">
                        <div class="stat-number" id="totalVisitors">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="activeUsers">0</div>
                        <div class="stat-label">–°–µ–π—á–∞—Å –æ–Ω–ª–∞–π–Ω</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="totalVisits">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏–π</div>
                    </div>
                </div>
                
                <div class="chart-controls">
                    <div class="last-update">
                        –û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="lastChartUpdate">--:--</span>
                    </div>
                    <button class="action-button" onclick="updateChartData()" id="refreshChartBtn">
                        <span class="refresh-icon">üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫
                    </button>
                    <button class="action-button secondary" onclick="toggleAutoRefresh()" id="autoRefreshBtn">
                        <span class="auto-refresh-icon">‚è±Ô∏è</span> –ê–≤—Ç–æ: <span id="autoRefreshStatus">–í–∫–ª</span>
                    </button>
                </div>
            </div>
            
            <!-- –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
            <div class="chart-card">
                <h3 class="chart-title">üìà –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                <div class="chart-wrapper">
                    <canvas id="activityChart"></canvas>
                </div>
                <div class="chart-footer">
                    <div>–ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</div>
                    <div>–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</div>
                </div>
            </div>
        </section>

        <!-- –ì—Ä–∞—Ñ–∏–∫–∏ –¥–æ–º–µ–Ω–æ–≤ –∏ —Ä–æ—Å—Ç–∞ -->
        <section class="centered-container">
            <h2 class="section-title">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
            <div style="display:flex;justify-content:center;gap:1rem;margin-bottom:2rem;flex-wrap:wrap;">
                <button class="action-button" onclick="refreshCharts()">
                    <span>üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å
                </button>
                <button class="action-button secondary" onclick="exportCharts()">
                    <span>üì•</span> –≠–∫—Å–ø–æ—Ä—Ç
                </button>
            </div>
            <div class="charts-container">
                <div class="chart-card">
                    <h3 class="chart-title">üéØ –î–æ–º–µ–Ω—ã email</h3>
                    <div class="chart-wrapper"><canvas id="domainChart"></canvas></div>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">üìÖ –ù–æ–≤—ã–µ –ø–æ –º–µ—Å—è—Ü–∞–º</h3>
                    <div class="chart-wrapper"><canvas id="growthChart"></canvas></div>
                </div>
            </div>
        </section>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="modal" id="userModal">
        <div class="modal-container">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;">
                <h3 style="background:linear-gradient(45deg,#60a5fa,var(--accent-blue));-webkit-background-clip:text;color:transparent;"
                    id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
                <button onclick="closeModal()" style="background:none;border:none;font-size:2rem;color:var(--text-secondary);">
                    &times;
                </button>
            </div>
            <form id="userForm" onsubmit="saveUser(event)">
                <input type="hidden" id="userId">
                <div style="margin-bottom:1.5rem;">
                    <label style="display:block;color:var(--text-secondary);margin-bottom:0.5rem;">üë§ –ò–º—è</label>
                    <input type="text" id="userName" class="search-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" required>
                </div>
                <div style="margin-bottom:1.5rem;">
                    <label style="display:block;color:var(--text-secondary);margin-bottom:0.5rem;">‚úâÔ∏è Email</label>
                    <input type="email" id="userEmail" class="search-input" placeholder="user@example.com" required>
                </div>
                <div style="display:flex;gap:1rem;margin-top:2rem;">
                    <button type="button" class="action-button secondary" onclick="closeModal()" style="flex:1;">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="action-button" style="flex:1;">
                        <span>‚úì</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ -->
    <div class="login-modal" id="loginModal">
        <div class="login-container">
            <div class="login-header">
                <div class="login-icon">üîê</div>
                <h2 class="login-title">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
                <p class="login-subtitle">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞</p>
            </div>
            
            <input type="password" 
                   id="adminPassword" 
                   class="password-input" 
                   placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
            
            <p class="password-hint">–ü–∞—Ä–æ–ª—å –∑–Ω–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã</p>
            
            <div class="login-actions">
                <button class="login-btn-secondary" onclick="closeLoginModal()">
                    <span>‚ùå</span> –û—Ç–º–µ–Ω–∞
                </button>
                <button class="login-btn-primary" onclick="loginAdmin()">
                    <span>üîì</span> –í–æ–π—Ç–∏
                </button>
            </div>
            
            <div class="login-error" id="loginError">
                ‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // === –ó–í–ï–ó–î–´ ===
        function createStars() {
            const c = document.getElementById('stars');
            if (!c) return;
            c.innerHTML = '';
            for (let i = 0; i < 150; i++) {
                const s = document.createElement('div');
                s.className = 'star';
                const sz = Math.random() * 2 + 1;
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                const d = Math.random() * 3 + 2;
                const dl = Math.random() * 5;
                s.style.cssText = `width:${sz}px;height:${sz}px;left:${x}%;top:${y}%;--duration:${d};--delay:${dl};`;
                c.appendChild(s);
            }
        }

        // === –¢–ï–ú–ê ===
        function initThemeToggle() {
            const t = document.getElementById('themeToggle');
            const i = document.getElementById('themeIcon');
            const txt = document.getElementById('themeText');
            const light = localStorage.getItem('usermanager_theme') === 'light';
            if (light) document.body.classList.add('light-theme');

            const u = (l) => {
                i.textContent = l ? '‚òÄÔ∏è' : 'üåô';
                txt.textContent = l ? '–°–≤–µ—Ç–ª–∞—è' : '–¢–µ–º–Ω–∞—è';
                if (window.updateChartColors) setTimeout(window.updateChartColors, 100);
            };
            u(light);

            t.addEventListener('click', () => {
                const l = !document.body.classList.contains('light-theme');
                document.body.classList.toggle('light-theme', l);
                localStorage.setItem('usermanager_theme', l ? 'light' : 'dark');
                u(l);
            });
        }

        // === –ì–†–ê–§–ò–ö–ò ===
        const charts = {};
        function initCharts() {
            if (typeof Chart === 'undefined') return setTimeout(initCharts, 100);

            const opt = (ax) => ({
                responsive: true,
                maintainAspectRatio: false,
                scales: ax ? { 
                    y: { 
                        beginAtZero: true, 
                        ticks: { color: '#bbdefb' }, 
                        grid: { color: 'rgba(255,255,255,0.1)' } 
                    },
                    x: { 
                        ticks: { color: '#bbdefb' }, 
                        grid: { color: 'rgba(255,255,255,0.1)' } 
                    } 
                } : {}
            });

            // –ì–†–ê–§–ò–ö –ê–ö–¢–ò–í–ù–û–°–¢–ò (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π, –º—ã –µ–≥–æ –æ–±–Ω–æ–≤–∏–º)
            charts.activity = new Chart('activityChart', {
                type: 'line',
                data: {
                    labels: ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'],
                    datasets: [{
                        label: '–ü–æ—Å–µ—â–µ–Ω–∏—è',
                        data: [65,59,80,81,56,55,40],
                        borderColor: '#60a5fa',
                        backgroundColor: 'rgba(96,165,250,0.1)',
                        borderWidth: 3, 
                        fill: true, 
                        tension: 0.4,
                        pointBackgroundColor: '#60a5fa'
                    }]
                },
                options: opt(true)
            });

            charts.domain = new Chart('domainChart', {
                type: 'pie',
                data: {
                    labels: ['gmail.com','mail.ru','yandex.ru','example.com'],
                    datasets: [{ 
                        data: [30,25,20,25], 
                        backgroundColor: ['#60a5fa','#34d399','#fbbf24','#a78bfa'] 
                    }]
                },
                options: { 
                    plugins: { 
                        legend: { 
                            labels: { 
                                color: function() {
                                    return getComputedStyle(document.documentElement).getPropertyValue('--text-secondary').trim() || '#bbdefb';
                                }
                            } 
                        } 
                    } 
                }
            });

            const m = ['–Ø–Ω–≤','–§–µ–≤','–ú–∞—Ä','–ê–ø—Ä','–ú–∞–π','–ò—é–Ω'];
            charts.growth = new Chart('growthChart', {
                type: 'bar',
                data: {
                    labels: m,
                    datasets: [{
                        label: '–ù–æ–≤—ã–µ', 
                        data: [42,38,45,50,47,52],
                        backgroundColor: '#34d399', 
                        borderRadius: 8
                    }]
                },
                options: opt(true)
            });

            window.charts = charts;
        }

        // === –û–ë–ù–û–í–õ–ï–ù–ò–ï –ì–†–ê–§–ò–ö–û–í ===
        function refreshCharts() {
            if (!window.getUsersForCharts) return showNotification('‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö', 'error');
            const u = window.getUsersForCharts();
            if (!u || !Array.isArray(u)) return;

            showNotification('üìä –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...', 'info');
            setTimeout(() => {
                try {
                    if (charts.activity) {
                        charts.activity.data.datasets[0].data = Array.from({length:7}, () => Math.floor(Math.random()*30)+20);
                        charts.activity.update();
                    }
                    if (charts.domain) {
                        const d = {}; 
                        u.forEach(x => {
                            if (x.email) {
                                const domain = x.email.split('@')[1];
                                d[domain] = (d[domain] || 0) + 1;
                            }
                        });
                        const tot = u.length;
                        const labels = Object.keys(d).slice(0,4);
                        const data = labels.map(k => Math.round((d[k]/tot)*100));
                        charts.domain.data.labels = labels;
                        charts.domain.data.datasets[0].data = data;
                        charts.domain.update();
                    }
                    if (charts.growth) {
                        charts.growth.data.datasets[0].data = Array.from({length:6}, () => Math.floor(Math.random()*20)+35);
                        charts.growth.update();
                    }
                    const now = new Date();
                    const timeStr = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
                    document.getElementById('lastUpdate').textContent = timeStr;
                    showNotification('‚úÖ –ì—Ä–∞—Ñ–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
                } catch (e) {
                    console.error(e);
                    showNotification('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤', 'error');
                }
            }, 500);
        }

        // === –§–£–ù–ö–¶–ò–ò –î–õ–Ø –°–ò–°–¢–ï–ú–´ –î–û–°–¢–£–ü–ê ===
        function showLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.add('active');
                document.getElementById('adminPassword').focus();
                
                // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Esc
                document.addEventListener('keydown', function closeOnEsc(e) {
                    if (e.key === 'Escape') {
                        closeLoginModal();
                        document.removeEventListener('keydown', closeOnEsc);
                    }
                });
                
                // –í–≤–æ–¥ –ø–æ Enter
                document.getElementById('adminPassword').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') loginAdmin();
                });
            }
        }

        function closeLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.remove('active');
            }
        }

        function loginAdmin() {
            const password = document.getElementById('adminPassword').value;
            const errorEl = document.getElementById('loginError');
            
            if (password === 'admin123') {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏
                const expiry = Date.now() + (30 * 60 * 1000); // 30 –º–∏–Ω—É—Ç
                localStorage.setItem('usermanager_admin_data', JSON.stringify({
                    logged: true,
                    expiry: expiry
                }));
                
                closeLoginModal();
                updateAccessUI();
                showNotification('‚úÖ –í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', 'success');
            } else {
                errorEl.style.display = 'block';
                const input = document.getElementById('adminPassword');
                input.style.animation = 'shake 0.5s';
                input.style.borderColor = '#f87171';
                input.value = '';
                setTimeout(() => input.style.animation = '', 500);
            }
        }

        function toggleApiMode() {
            const adminData = localStorage.getItem('usermanager_admin_data');
            const isAdmin = adminData ? JSON.parse(adminData).logged && Date.now() < JSON.parse(adminData).expiry : false;
            
            if (!isAdmin) {
                showNotification('üîí –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å —Ä–µ–∂–∏–º—ã', 'warning');
                showLoginModal();
                return;
            }

            const useRealApi = localStorage.getItem('usermanager_use_real_api') !== 'false';
            const newMode = !useRealApi;
            
            localStorage.setItem('usermanager_use_real_api', newMode.toString());
            
            showNotification(
                newMode ? 
                'üåê –í–∫–ª—é—á–µ–Ω —Å–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º' : 
                'üíæ –í–∫–ª—é—á–µ–Ω –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º',
                newMode ? 'info' : 'warning'
            );
            
            updateAccessUI();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
            if (window.location.pathname.includes('index.html') || window.location.pathname === '/' || window.location.pathname.endsWith('/')) {
                if (typeof loadUsers === 'function') loadUsers();
                if (typeof updateChartData === 'function') updateChartData();
            }
        }

        function updateAccessUI() {
            const adminData = localStorage.getItem('usermanager_admin_data');
            const isAdmin = adminData ? JSON.parse(adminData).logged && Date.now() < JSON.parse(adminData).expiry : false;
            const useRealApi = localStorage.getItem('usermanager_use_real_api') !== 'false';
            
            // –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞
            const loginBtn = document.getElementById('loginButton');
            if (loginBtn) {
                if (isAdmin) {
                    loginBtn.innerHTML = '<span>üëë</span> <span>–ê–¥–º–∏–Ω</span>';
                    loginBtn.classList.add('admin');
                    loginBtn.onclick = function() {
                        if (confirm('–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞?')) {
                            localStorage.removeItem('usermanager_admin_data');
                            updateAccessUI();
                            showNotification('üëã –í—ã –≤—ã—à–ª–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞', 'info');
                        }
                    };
                } else {
                    loginBtn.innerHTML = '<span>üîê</span> <span>–í–æ–π—Ç–∏</span>';
                    loginBtn.classList.remove('admin');
                    loginBtn.onclick = showLoginModal;
                }
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–æ–≤
            const apiModeBtn = document.getElementById('apiModeButton');
            const apiModeIcon = document.getElementById('apiModeIcon');
            const apiModeText = document.getElementById('apiModeText');
            
            if (apiModeBtn && apiModeIcon && apiModeText) {
                if (isAdmin) {
                    apiModeBtn.style.display = 'flex';
                    apiModeIcon.textContent = useRealApi ? 'üåê' : 'üíæ';
                    apiModeText.textContent = useRealApi ? '–°–µ—Ä–≤–µ—Ä–Ω—ã–π' : '–õ–æ–∫–∞–ª—å–Ω—ã–π';
                    apiModeBtn.className = useRealApi ? 'api-mode-btn' : 'api-mode-btn local';
                    apiModeBtn.title = `–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ ${useRealApi ? '–ª–æ–∫–∞–ª—å–Ω—ã–π' : '—Å–µ—Ä–≤–µ—Ä–Ω—ã–π'} —Ä–µ–∂–∏–º`;
                } else {
                    apiModeBtn.style.display = 'none';
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ —Ä–µ–∂–∏–º–µ
            const serverStatus = document.getElementById('serverStatus');
            if (serverStatus) {
                serverStatus.textContent = useRealApi ? 'üü¢ –û–Ω–ª–∞–π–Ω' : 'üîí –õ–æ–∫–∞–ª—å–Ω—ã–π';
                serverStatus.style.color = useRealApi ? '#4ade80' : '#a78bfa';
            }
            
            const modeText = document.getElementById('modeText');
            const modeIcon = document.getElementById('modeIcon');
            if (modeText && modeIcon) {
                modeText.textContent = useRealApi ? '–°–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º' : '–õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º';
                modeIcon.textContent = useRealApi ? 'üåê' : 'üíæ';
            }
        }

        // === –§–£–ù–ö–¶–ò–ò –î–õ–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ò –ò –ì–†–ê–§–ò–ö–ê ===
        let autoRefreshInterval = null;

        function updateChartData() {
            const refreshBtn = document.getElementById('refreshChartBtn');
            if (!refreshBtn) return;
            
            const originalHTML = refreshBtn.innerHTML;
            refreshBtn.innerHTML = '<span class="spinner"></span> –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...';
            refreshBtn.disabled = true;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            updateUserStats();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∏–∑ localStorage
            const history = JSON.parse(localStorage.getItem('usermanager_chart_history') || '[]');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å
            const today = new Date().toLocaleDateString('ru-RU');
            const todayData = history.find(h => h.date === today);
            
            if (todayData) {
                todayData.visits += Math.floor(Math.random() * 5) + 1;
                const stats = JSON.parse(localStorage.getItem('usermanager_user_stats') || '{}');
                todayData.activeUsers = stats.activeUsers || 0;
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –¥–µ–Ω—å
                const days = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
                const stats = JSON.parse(localStorage.getItem('usermanager_user_stats') || '{}');
                history.push({
                    date: today,
                    day: days[new Date().getDay()],
                    visits: stats.totalVisits || 1,
                    activeUsers: stats.activeUsers || 1
                });
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é 7 –¥–Ω—è–º–∏
                if (history.length > 7) {
                    history.shift();
                }
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é
            localStorage.setItem('usermanager_chart_history', JSON.stringify(history));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            if (window.charts && window.charts.activity) {
                const chart = window.charts.activity;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                chart.data.datasets[0].data = history.map(h => h.visits);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –≤—Ç–æ—Ä–æ–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö (–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
                if (chart.data.datasets.length < 2) {
                    chart.data.datasets.push({
                        label: '–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏',
                        data: history.map(h => h.activeUsers),
                        borderColor: '#34d399',
                        backgroundColor: 'rgba(52, 211, 153, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#34d399'
                    });
                } else {
                    chart.data.datasets[1].data = history.map(h => h.activeUsers);
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å–∏
                chart.data.labels = history.map(h => `${h.day} (${h.date})`);
                
                chart.update('none');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            const now = new Date();
            const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            const updateElement = document.getElementById('lastChartUpdate');
            if (updateElement) {
                updateElement.textContent = timeStr;
                updateElement.style.color = '#34d399';
                updateElement.style.fontWeight = '600';
                
                setTimeout(() => {
                    updateElement.style.color = '';
                    updateElement.style.fontWeight = '';
                }, 2000);
            }
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            setTimeout(() => {
                refreshBtn.innerHTML = originalHTML;
                refreshBtn.disabled = false;
                showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
            }, 500);
        }

        function toggleAutoRefresh() {
            const isEnabled = localStorage.getItem('usermanager_auto_refresh') !== 'false';
            const newState = !isEnabled;
            
            localStorage.setItem('usermanager_auto_refresh', newState.toString());
            
            if (newState) {
                startAutoRefresh();
                showNotification('‚è±Ô∏è –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)', 'info');
            } else {
                stopAutoRefresh();
                showNotification('‚è±Ô∏è –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ', 'warning');
            }
            
            updateAutoRefreshButton(newState);
        }

        function startAutoRefresh() {
            if (autoRefreshInterval) clearInterval(autoRefreshInterval);
            
            autoRefreshInterval = setInterval(() => {
                if (document.visibilityState === 'visible') {
                    updateChartData();
                }
            }, 30000); // 30 —Å–µ–∫—É–Ω–¥
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }

        function updateAutoRefreshButton(isEnabled) {
            const btn = document.getElementById('autoRefreshBtn');
            const status = document.getElementById('autoRefreshStatus');
            
            if (btn && status) {
                btn.innerHTML = isEnabled ? 
                    '<span>‚è±Ô∏è</span> –ê–≤—Ç–æ: <span id="autoRefreshStatus">–í–∫–ª</span>' :
                    '<span>‚è±Ô∏è</span> –ê–≤—Ç–æ: <span id="autoRefreshStatus">–í—ã–∫–ª</span>';
                btn.style.background = isEnabled ? 
                    'rgba(34, 197, 94, 0.2)' : 
                    'rgba(239, 68, 68, 0.2)';
                btn.style.borderColor = isEnabled ? 
                    'rgba(34, 197, 94, 0.4)' : 
                    'rgba(239, 68, 68, 0.4)';
            }
        }

        function updateUserStats() {
            let stats = JSON.parse(localStorage.getItem('usermanager_user_stats') || '{}');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
            if (!stats.totalVisitors) {
                stats = {
                    totalVisitors: 1,
                    activeUsers: 1,
                    totalVisits: 1,
                    visitorHistory: [],
                    userSessions: {}
                };
            }
            
            // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è
            let visitorId = localStorage.getItem('usermanager_visitor_id');
            if (!visitorId) {
                visitorId = 'visitor_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('usermanager_visitor_id', visitorId);
                stats.totalVisitors++;
            }
            
            // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Å–µ—Å—Å–∏—é
            const sessionId = 'session_' + Date.now();
            stats.userSessions[sessionId] = {
                visitorId: visitorId,
                startTime: Date.now(),
                lastActivity: Date.now(),
                active: true
            };
            
            stats.totalVisits++;
            
            // –û—á–∏—â–∞–µ–º –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ (–±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç)
            const now = Date.now();
            const inactiveTime = 5 * 60 * 1000;
            for (const sid in stats.userSessions) {
                if (now - stats.userSessions[sid].lastActivity > inactiveTime) {
                    delete stats.userSessions[sid];
                }
            }
            
            stats.activeUsers = Object.keys(stats.userSessions).length;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            localStorage.setItem('usermanager_user_stats', JSON.stringify(stats));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const totalVisitorsEl = document.getElementById('totalVisitors');
            const activeUsersEl = document.getElementById('activeUsers');
            const totalVisitsEl = document.getElementById('totalVisits');
            
            if (totalVisitorsEl) totalVisitorsEl.textContent = stats.totalVisitors;
            if (activeUsersEl) activeUsersEl.textContent = stats.activeUsers;
            if (totalVisitsEl) totalVisitsEl.textContent = stats.totalVisits;
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification show ${type}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <span style="font-size: 1.2rem;">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
        document.addEventListener('DOMContentLoaded', () => {
            createStars();
            window.addEventListener('resize', createStars);
            initThemeToggle();
            setTimeout(initCharts, 300);

            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –¥–æ—Å—Ç—É–ø–∞
            updateAccessUI();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            updateUserStats();
            
            // –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ
            const autoRefreshEnabled = localStorage.getItem('usermanager_auto_refresh') !== 'false';
            if (autoRefreshEnabled) {
                startAutoRefresh();
                updateAutoRefreshButton(true);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
            setInterval(updateUserStats, 60000);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            document.addEventListener('mousemove', () => {
                const stats = JSON.parse(localStorage.getItem('usermanager_user_stats') || '{}');
                if (stats.userSessions) {
                    const sessionId = Object.keys(stats.userSessions)[0];
                    if (sessionId && stats.userSessions[sessionId]) {
                        stats.userSessions[sessionId].lastActivity = Date.now();
                        localStorage.setItem('usermanager_user_stats', JSON.stringify(stats));
                    }
                }
            });
            
            document.addEventListener('keydown', () => {
                const stats = JSON.parse(localStorage.getItem('usermanager_user_stats') || '{}');
                if (stats.userSessions) {
                    const sessionId = Object.keys(stats.userSessions)[0];
                    if (sessionId && stats.userSessions[sessionId]) {
                        stats.userSessions[sessionId].lastActivity = Date.now();
                        localStorage.setItem('usermanager_user_stats', JSON.stringify(stats));
                    }
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            setTimeout(updateChartData, 1000);
        });
    </script>
</body>
</html>